<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<link rel="icon" href="/images/WorldBay_Logo.ico">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>WorldBay - Update Item</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body>
	<div th:replace="fragments/navbarHeader"></div>
	<div class="container">
		<h1>Update Item</h1>

		<form th:action="@{/items/edit/{id}(id=${item.id})}" method="post" th:object="${item}"
			enctype="multipart/form-data">
			<div class="mb-3 col-5">
				<label for="item_name" class="form-label">Name</label>
				<input id="item_name" type="text" class="form-control" th:field="*{name}" />
			</div>
			<div class="mb-3 col-5">
				<label for="item_description" class="form-label">Description</label>
				<input id="item_description" type="text" class="form-control" th:field="*{description}" />
			</div>
			<div class="mb-3 col-5">
				<label for="item_quantity" class="form-label">Quantity</label>
				<input id="item_quantity" type="number" class="form-control" th:field="*{quantity}" />
			</div>
			<div class="mb-3 col-5">
				<label for="item_price" class="form-label">Price</label>
				<input id="item_price" type="number" step="0.01" class="form-control" th:field="*{price}" />
			</div>
			<div class="mb-3 col-5">
				<label for="category_list" class="form-label">Category</label>
				<select id="category_list" class="form-control" th:field="*{category}">
					<option value="">Choose one</option>
					<option th:each="cat : ${catList}" th:value="${cat.id}" th:text="${cat.name}"></option>
				</select>
			</div>
			<div class="mb-3 col-5">
				<label for="itemImage" class="form-label">Item Image:</label>
				<input id="itemImage" class="form-control" type="file" name="itemImage" accept="image/png, image/jpeg"
					onchange="previewImage(event)" />
				<small id="fileSizeMessage" class="form-text text-muted">Image file size should not exceed 20MB.</small>
				<br><img id="oldImage" class="mt-3 img-fluid" th:if="${item.imgName != null && item.imgName != ''}"
					th:src="@{/uploads/items/{id}/{imgpath}(id=${item.id}, imgpath=${item.imgName})}" />
				<img id="newImage" class="mt-3 img-fluid" style="display: none;" />
			</div>

			<script>
				function previewImage(event) {
					var input = event.target;
					var oldImage = document.getElementById("oldImage");
					var newImage = document.getElementById("newImage");

					if (input.files && input.files[0]) {
						var reader = new FileReader();

						reader.onload = function (e) {
							newImage.src = e.target.result;
							newImage.style.display = "block";
							oldImage.style.display = "none";
						}

						reader.readAsDataURL(input.files[0]);
					} else {
						newImage.style.display = "none";
						oldImage.style.display = "block";
					}
				}
			</script>
			<div class="mt-3 mb-5">
				<button class="btn btn-primary">Update Item</button>
			</div>
		</form>
	</div>
	<div th:replace="fragments/footer"></div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"></script>
</body>

</html>